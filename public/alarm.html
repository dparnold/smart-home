<!DOCTYPE html>
<html lang="en">

<head id="head">
    <link rel="stylesheet" href="css/alarm.css" type="text/css">
    <script src="js/jquery-3.5.1.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Our Sweet Smart Home">
    <meta name="author" content="Dominik Arnold">

    <link rel="stylesheet" href="css/style.css" type="text/css">

    <script>
        var ip = "192.168.2.142:3000";
    </script>


    <title>alarm</title>

</head>

<body>
    <header id="header">
        <script>$("#header").load("header.html");</script>
    </header>


    <div class="message">
        <p id="message"></p>
    </div>

    <div id="content" class="content">



        <div class="alarmform" id="alarm">
            <p>Alarm</p>
            <div class="time">
                <input type="number" id="hours" value="06" maxlength="2" size="2" max="23" min="00">
                <span>:</span>
                <input type="number" id="minutes" value="30" maxlength="2" size="2" max="59" min="00">
            </div>
            <div class="buttons">
                <button onclick="setAlarm()">
                    Set
                </button>
                <button onclick="stopAlarm()">
                    Stop
                </button>
            </div>
        </div>
        <br>
        <br>
        <div class="alarmform" id="snooze">
            <p>Snooze Timer</p>
            <input type="number" id="snoozeInput" value="06" maxlength="2" size="2" max="23" min="00">
            <div class="buttons">
                <button onclick="setSnooze()">
                    Set Snooze
                </button>

            </div>
        </div>


        <script>
            var messageTime = 5000; // in ms
            function setAlarm() {
                hours = document.getElementById("hours").value;
                minutes = document.getElementById("minutes").value;
                var now = new Date();
                var alarmDate = new Date();
                alarmDate.setHours(hours);
                alarmDate.setMinutes(minutes);
                alarmDate.setSeconds(0);
                if ((alarmDate.getTime() - now.getTime()) <= 0) {
                    alarmDate.setTime(alarmDate.getTime() + 86400000);
                }
                difference = (alarmDate.getTime() - now.getTime()) / 1000;
                document.getElementById("message").innerHTML = "The alarm will start in " + Math.round((difference / 3600) * 10) / 10 + " hours.";
                setTimeout(function () {document.getElementById("message").innerHTML="";}, messageTime);
                $.ajax({
                    type: "GET",
                    url: "http://" + ip + "/api/alarm/set/" + difference,
                    success: function (result) {
                    }
                });
            }
            function stopAlarm() {
                document.getElementById("message").innerHTML = "The alarm was stopped.";
                setTimeout(function () {document.getElementById("message").innerHTML="";}, messageTime);
                $.ajax({
                    type: "GET",
                    url: "http://" + ip + "/api/alarm/stop",
                    success: function (result) {
                    }
                });
            }
            function setSnooze() {
                snooze = document.getElementById("snoozeInput").value;
                document.getElementById("message").innerHTML = "The light will turn off in " + snooze/1 + " minutes.";
                setTimeout(function () {document.getElementById("message").innerHTML="";}, messageTime);
                $.ajax({
                    type: "GET",
                    url: "http://" + ip + "/api/socket/1/1/0",
                    success: function (result) {
                    }
                });

                $.ajax({
                    type: "GET",
                    url: "http://" + ip + "/api/socket/1/0/" + snooze * 60,
                    success: function (result) {
                    }
                });
            }
        </script>
    </div>

</body>

</html>

<!doctype html>